import{t as N,k as J,a as M,g as B,d as H,c as z,e as F,b as U,f as A,h as G,_ as R}from"./kore-f1b6d74a.js";import{d as E,o as a,e as C,g as T,f as I,r as w,w as K,c as v,F as x,i as P,j as S,u as Q,a as L,t as q,h as D,n as W,E as j,_ as X}from"./index-1fe75c98.js";function Y(p,_){let y=null;return function(){y&&clearTimeout(y),y=setTimeout(()=>{p.call(this,...arguments)},_)}}const $={__name:"formItem",props:{item:Object,form:Object},setup(p){const _=N(),y=(o,t)=>{if(t.type==="background"){const e=document.querySelector(t.targetElement);e&&(e.style.background=`url(${o}) center/cover no-repeat`)}else{const e=document.querySelector(t.targetElement);e&&(e[t.type]=o)}},d=o=>{g(o),_.timer=setTimeout(()=>{r(o)},1500)},g=o=>{_.timer&&clearTimeout(_.timer);const t=document.querySelector(".is-selected");t&&(t.classList.remove("is-selected"),setTimeout(()=>{e&&e.classList.remove("scale")},200));const e=document.querySelector(o.targetElement),i=document.querySelector(".template-content");e&&(e.classList.add("scale"),e.classList.add("is-selected"),i&&i.classList.add("template-mask"),e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}))},r=o=>{const t=document.querySelector(".template-content"),e=document.querySelector(o.targetElement);e&&e.classList.remove("is-selected"),setTimeout(()=>{e&&e.classList.remove("scale")},200),t&&t.classList.remove("template-mask")};return(o,t)=>{const e=E("el-input"),i=E("el-form-item");return a(),C(i,{label:p.item.label},{default:T(()=>[I(e,{onClick:t[0]||(t[0]=f=>d(p.item)),type:"textarea",modelValue:p.form[p.item.field],"onUpdate:modelValue":t[1]||(t[1]=f=>p.form[p.item.field]=f),onInput:t[2]||(t[2]=f=>y(f,p.item))},null,8,["modelValue"])]),_:1},8,["label"])}}},Z={style:{"padding-bottom":"10px","font-weight":"bold","text-align":"center"}},ee={__name:"index",setup(p,{expose:_}){const y=N(),d=w({}),g=w([]),r=(n,l)=>{const c=document.querySelector(n.targetElement);if(c)if(n.type==="background"){const u=c.style.background,k=/url\((['"]?)(.*?)\1\)/,h=u.match(k);d.value[n.field]=h?h[2]:""}else d.value[n.field]=c[n.type];else d.value[n.field]="",l.children=l.children.filter(u=>u.field!==n.field)},o=n=>{W(()=>{g.value.forEach(l=>{["innerText","src","href","background"].includes(l.type)?r(l):["productImg","productDesc"].includes(l.type)?l.children.forEach(c=>{r(c,l)}):["comment"].includes(l.type)&&(n?l.children.forEach(c=>{c.children.forEach(u=>{r(u,c)})}):l.children.forEach(c=>{r(c,l)}))})})};K(()=>{y.currentTemplate==="kore"?g.value=JSON.parse(JSON.stringify(J)):y.currentTemplate==="kore-jar2"&&(g.value=JSON.parse(JSON.stringify(M))),o(!0)});const t=(n,l,c,u,k,h)=>{const s=document.querySelectorAll(n);g.value.forEach(m=>{if(m.type===l)if(h.type===c){const b=u(s.length+1);m.children.push(b),k(s.length+1),o(!0)}else{const b=s[s.length-1];b&&b.remove(),o()}})},e=n=>{["addProductImg","delProductImg"].includes(n.type)?t("#gallery_nav a","productImg","addProductImg",H,B,n):["addComment","delComment"].includes(n.type)?t(".kore-customer-review .row .col-xs-12","comment","addComment",F,z,n):["addProductDesc","delProductDesc"].includes(n.type)&&t(".right-content ul li","productDesc","addProductDesc",A,U,n)},i=w(""),f=w([]),O=Y(n=>{const l="jsonpCallback",c=document.createElement("script");c.src=`${n}.json?callback=${l}`,document.body.appendChild(c),window[l]=u=>{if(u!=null&&u.product){j.success({message:"获取成功",type:"success"}),f.value=u.product.images.map(s=>s.src);const k=G(f.value),h=document.getElementById("gallery");h.innerHTML=k,o(),document.body.removeChild(c),delete window[l]}}},500);return _({form:d,templateOptions:g}),(n,l)=>{const c=E("el-input"),u=E("el-form-item"),k=E("el-button"),h=E("el-form");return a(),C(h,{model:d.value,"label-width":"auto","label-position":"top"},{default:T(()=>[(a(!0),v(x,null,P(g.value,s=>(a(),v(x,{key:s.field},[["innerText","src","href","background"].includes(s.type)?(a(),C($,{key:0,form:d.value,item:s},null,8,["form","item"])):S("",!0),["productImg","productDesc"].includes(s.type)?(a(),v(x,{key:1},[["productImg"].includes(s.type)?(a(),C(u,{key:0,label:"产品链接(可用来一键获取产品图)"},{default:T(()=>[I(c,{type:"textarea",placeholder:"例如：https://www.xxxx.com/products/xxxxx",modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=m=>i.value=m),onInput:Q(O)},null,8,["modelValue","onInput"])]),_:1})):S("",!0),(a(!0),v(x,null,P(s.children,m=>(a(),C($,{key:m.field,form:d.value,item:m},null,8,["form","item"]))),128))],64)):S("",!0),["comment"].includes(s.type)?(a(!0),v(x,{key:2},P(s.children,m=>(a(),v(x,{key:m.field},[L("div",Z,q(m.label),1),(a(!0),v(x,null,P(m.children,b=>(a(),C($,{key:b.field,form:d.value,item:b},null,8,["form","item"]))),128))],64))),128)):S("",!0),["addProductImg","delProductImg","addProductDesc","delProductDesc","addComment","delComment"].includes(s.type)?(a(),C(k,{key:3,style:{"margin-bottom":"10px"},onClick:m=>e(s),type:["addProductImg","addComment","addProductDesc"].includes(s.type)?"primary":"danger",size:"small",plain:""},{default:T(()=>[D(q(s.label),1)]),_:2},1032,["onClick","type"])):S("",!0)],64))),128))]),_:1},8,["model"])}}};const te={class:"select-template-container"},oe={class:"select-template-btn"},ne={class:"template-container"},le={class:"options"},se={class:"template"},ce={__name:"index",setup(p){const _=N(),y=r=>{_.currentTemplate=r},d=w(null),g=()=>{const r=d.value.form,o={};d.value.templateOptions.forEach(e=>{if(["productImg","productDesc"].includes(e.type)){const i=[];e.children.forEach(f=>{i.push(r[f.field]),o[e.type]=i})}else if(e.type==="comment"){const i=[];e.children.forEach(f=>{const V={};f.children.forEach(O=>{V[O.field]=r[O.field]}),i.push(V)}),o[e.type]=i}else["src","background","innerText","href"].includes(e.type)&&r[e.field]&&(o[e.field]=r[e.field])});const t=JSON.stringify(o);navigator.clipboard.writeText(t).then(()=>{j.success({message:"复制成功",type:"success"})})};return(r,o)=>{const t=E("el-button");return a(),v("div",te,[L("div",oe,[I(t,{type:"primary",plain:"",onClick:o[0]||(o[0]=e=>r.$router.push("/")),size:"small"},{default:T(()=>[D("返回首页")]),_:1}),I(t,{type:"success",plain:"",onClick:g,size:"small"},{default:T(()=>[D("生成代码")]),_:1}),I(t,{type:"warning",plain:"",onClick:o[1]||(o[1]=e=>y("kore")),size:"small"},{default:T(()=>[D("kore")]),_:1})]),L("div",ne,[L("div",le,[I(ee,{ref_key:"templateLeft",ref:d},null,512)]),L("div",se,[I(R)])])])}}},de=X(ce,[["__scopeId","data-v-9e5817ca"]]);export{de as default};
